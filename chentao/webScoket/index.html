<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Client</title>
    <script src='https://cdn.bootcss.com/jquery/1.8.3/jquery.js' type='text/javascript' charset='utf-8'></script>
</head>

<body>
    <div id="container"> </div>
    <div>
        <input type="text" id="content" name="" value="">
        <button id="submit">提交</button>
    </div>
</body>

</html>

<script>
    function Page() {
        this.containerElem = $("#container");
        this.contentElem = $("#content");
        this.submit = $("#submit");
        this.ws = new WebSocket("ws://127.0.0.1:9000");
    }

    // extend 合并，将第二个对象合并到第一个对象上
    $.extend(Page.prototype, {

        init: function() {
            this.bindEvents();
        },
        bindEvents: function() {
            this.submit.on("click", $.proxy(this.handleSubmitClick, this))
            this.ws.onmessage = $.proxy(this.handleGetMessage, this);
            this.ws.onerror = $.proxy(this.handleClientError, this);
        },
        handleSubmitClick: function() {
            var inputValue = this.contentElem.val();
            this.ws.send(inputValue)
            this.contentElem.val("")
        },
        handleGetMessage: function(e) {
            var content = e.data;
            this.containerElem.append('<div>' + content + '</div>');
        },
        handleClientError: function() {
            console.log("出错了")
        }

    })


    var page = new Page();
    page.init();



    // proxy改变作用域
    // proxy: function( fn, context ) {
    // 	var tmp, args, proxy;
    // 	if ( typeof context === "string" ) {
    // 		tmp = fn[ context ];
    // 		context = fn;
    // 		fn = tmp;
    // 	}
    // 	// Quick check to determine if target is callable, in the spec
    // 	// this throws a TypeError, but we will just return undefined.
    // 	if ( !jQuery.isFunction( fn ) ) {
    // 		return undefined;
    // 	}
    // 	// Simulated bind
    // 	args = core_slice.call( arguments, 2 );
    // 	proxy = function() {
    // 		return fn.apply( context, args.concat( core_slice.call( arguments ) ) );
    // 	};
    // 	// Set the guid of unique handler to the same of original handler, so it can be removed
    // 	proxy.guid = fn.guid = fn.guid || jQuery.guid++;
    // 	return proxy;
    // }
</script>